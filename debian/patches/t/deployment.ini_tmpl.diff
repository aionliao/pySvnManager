From: Jiang <jiangxin@ossxp.com>
Subject: [PATCH] t/deployment.ini_tmpl

Set prefix filter middleware, and integrate with apache https.

Signed-off-by: Jiang <jiangxin@ossxp.com>

---
 pysvnmanager/config/deployment.ini_tmpl |   24 ++++++++++++++----------
 pysvnmanager/config/localconfig.py.in   |   26 ++++++++++++++++----------
 2 files changed, 30 insertions(+), 20 deletions(-)

diff --git a/pysvnmanager/config/deployment.ini_tmpl b/pysvnmanager/config/deployment.ini_tmpl
index 66e5fcc..16e891c 100644
--- a/pysvnmanager/config/deployment.ini_tmpl
+++ b/pysvnmanager/config/deployment.ini_tmpl
@@ -4,7 +4,7 @@
 # The %(here)s variable will be replaced with the parent directory of this file
 #
 [DEFAULT]
-debug = true
+debug = false
 email_to = you@yourdomain.com
 smtp_server = localhost
 error_email_from = paste@localhost
@@ -14,7 +14,7 @@ use = egg:Paste#http
 host = 0.0.0.0
 port = 5000
 
-[app:main]
+[app:myapp]
 use = egg:pySvnManager
 full_stack = true
 static_files = true
@@ -40,10 +40,6 @@ sqlalchemy.url = sqlite:///%(here)s/db/production.db
 # execute malicious code after an exception is raised.
 set debug = false
 
-# If want to serve webapp with a prefix, un-comment this line, and add a
-# [filter:proxy-prefix] section
-#filter-with = proxy-prefix
-
 # Set unittest to True only for unittest mode. (nosetests)
 # Warning: if unitest is enabled, i18n for svnauthz module not work any more.
 #unittest = True
@@ -55,11 +51,19 @@ authn_file = %(here)s/config/svn.passwd
 authz_file = %(here)s/config/svn.access
 
 # svn repository root path
-repos_root = %(here)s/svnroot
+repos_root = /opt/svn/svnroot
+
+[filter:proxy-prefix]
+use = egg:PasteDeploy#prefix
+prefix = /svnadmin
+scheme = https
+
+[pipeline:main]
+## Direct connect without proxy
+pipeline = myapp
 
-#[filter:proxy-prefix]
-#use = egg:PasteDeploy#prefix
-#prefix = /svnadmin
+## Serve webapp behind apache2 proxy, need this.
+#pipeline = proxy-prefix myapp
 
 # Logging configuration
 [loggers]
diff --git a/pysvnmanager/config/localconfig.py.in b/pysvnmanager/config/localconfig.py.in
index 0b56a15..948efce 100644
--- a/pysvnmanager/config/localconfig.py.in
+++ b/pysvnmanager/config/localconfig.py.in
@@ -10,19 +10,25 @@ class LocalConfig(DefaultConfig):
     # pysvnmanager authentication method.
     # You can use htpasswd_login, or ldap_login, or both.
     # You can also implement your own auth module.
-    from pysvnmanager.model.auth.http import htpasswd_login
-    auth = [htpasswd_login]
+    #from pysvnmanager.model.auth.http import htpasswd_login
+    #auth = [htpasswd_login]
 
     # Htpasswd login parameters
     # Note: custom `authn_file' in your <deploy>.ini file
 
-    #import ldap
-    #from pysvnmanager.model.auth.ldap_login import ldap_login
-    #auth = [ldap_login]
+    import ldap
+    from pysvnmanager.model.auth.ldap_login import ldap_login
+    auth = [ldap_login]
 
     ## LDAP login parameters
-    #ldap_uri = 'ldap://localhost'
-    #ldap_binddn = 'cn=ldapadmin,dc=foo,dc=bar'
-    #ldap_bindpw = 'guess'
-    #ldap_base = 'dc=foo,dc=bar'
-    #ldap_filter = '(authorizedService=svn)(ossxpConfirmed=TRUE)'
+    ldap_uri = 'ldap://localhost'
+    ldap_binddn = 'cn=ldapadmin,dc=foo,dc=bar'
+    ldap_bindpw = 'guess'
+    ldap_base = 'dc=foo,dc=bar'
+    ldap_filter = '(authorizedService=svn)(ossxpConfirmed=TRUE)'
+
+    ## Logout redirect url, if using external auth backend
+    logout_url = 'http://weblogin.foo.bar/cgi-bin/logout'
+
+    ## If needs to expire certain cookie, list here.
+    #logout_cookie = ['cookiename']
-- 
tg: (aba495c..) t/deployment.ini_tmpl (depends on: master)
